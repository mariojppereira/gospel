<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.7">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">Function contracts | Gospel</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://ocaml-gospel.github.io/gospel/language/function-contracts"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Function contracts | Gospel"><meta data-react-helmet="true" name="description" content="A function contract is a formal Gospel specification attached to the declaration"><meta data-react-helmet="true" property="og:description" content="A function contract is a formal Gospel specification attached to the declaration"><link data-react-helmet="true" rel="canonical" href="https://ocaml-gospel.github.io/gospel/language/function-contracts"><link data-react-helmet="true" rel="alternate" href="https://ocaml-gospel.github.io/gospel/language/function-contracts" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://ocaml-gospel.github.io/gospel/language/function-contracts" hreflang="x-default"><link rel="stylesheet" href="/gospel/assets/css/styles.c452465b.css">
<link rel="preload" href="/gospel/assets/js/runtime~main.289d4682.js" as="script">
<link rel="preload" href="/gospel/assets/js/main.6b291231.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#ffba00" role="banner"><div class="announcementBarContent_3EUC"><strong>âš  This documentation is still work-in-progress; its contents is unstable.</strong></div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/gospel/"><b class="navbar__title">Gospel</b></a><a class="navbar__item navbar__link navbar__link--active" href="/gospel/">Docs</a><a class="navbar__item navbar__link" href="/gospel/stdlib">Standard Library</a><a class="navbar__item navbar__link" href="/gospel/faq">FAQ</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ocaml-gospel/gospel" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/gospel/">Welcome!</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Getting Started</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Walk-throughs</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Language specification</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/gospel/language/locations">Specification locations</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/gospel/language/lexical-conventions">Lexical conventions</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/gospel/language/formulae">Terms and Formulae</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/gospel/language/type-specifications">Types specifications</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/gospel/language/constants-specifications">Constants specifications</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/gospel/language/function-contracts">Function contracts</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/gospel/language/logical">Logical declarations</a></li></ul></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/gospel/good-practices">Tips and good practices</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Function contracts</h1></header><p>A function contract is a formal Gospel specification attached to the declaration
of an OCaml function in an interface. Here is an example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">val</span><span class="token plain"> euclidean_division</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> int </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> int </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> int </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> int</span></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ q, r = euclidean_division x y</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    requires y &gt; 0</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    ensures  x = q * y + r</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    ensures  0 &lt;= r &lt; y *)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>A function contract is composed of two parts:</p><ul><li>The first line is the <strong>header</strong> of the contract; it names the function
arguments and result. It must appear at the beginning of the contract.</li><li>The next lines contain as many specification <code>clauses</code> as needed. The
previous example features three clauses: one pre-condition introduced by
<code>requires</code>, and two post-conditions introduced by <code>ensures</code>.</li></ul><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>   In the absence of a contract attached to a function declaration, you cannot
make any assumptions about its behaviour.</p><p>   Post-Conditions may not hold, the function may diverge, raise unlisted
exceptions, modify mutable states. However, <strong>it still cannot break any type
invariant.</strong></p><p>   You can still enable the default implicit properties about exceptions, mutability,
non-termination, etc. by creating an empty contract:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">val</span><span class="token plain"> euclidean_division</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> int </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> int </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> int </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> int</span></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ q, r = euclidean_division x y *)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div><div class="codeBlockContainer_K1bP"><div style="color:#403f53;background-color:#FBFBFB" class="codeBlockTitle_eoMF">Function contract syntax</div><div class="codeBlockContent_hGly ebnf"><pre tabindex="0" class="prism-code language-ebnf codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token plain">contract = header? clause*</span></span><span class="token-line" style="color:#403f53"><span class="token plain">header = (identifier_tuple &quot;=&quot;)? identifier parameter+</span></span><span class="token-line" style="color:#403f53"><span class="token plain">clause = &quot;requires&quot; formula</span></span><span class="token-line" style="color:#403f53"><span class="token plain">       | &quot;checks&quot; formula</span></span><span class="token-line" style="color:#403f53"><span class="token plain">       | &quot;ensures&quot; formula</span></span><span class="token-line" style="color:#403f53"><span class="token plain">       | &quot;raises&quot; exception_case (&quot;|&quot; exception-case)*</span></span><span class="token-line" style="color:#403f53"><span class="token plain">       | &quot;modifies&quot; expr (&quot;,&quot; expr)*</span></span><span class="token-line" style="color:#403f53"><span class="token plain">       | &quot;equivalent&quot; string_literal</span></span><span class="token-line" style="color:#403f53"><span class="token plain">       | &quot;diverges&quot;</span></span><span class="token-line" style="color:#403f53"><span class="token plain">       | &quot;pure&quot;</span></span><span class="token-line" style="color:#403f53"><span class="token plain">       | &quot;consumes&quot; expr (&quot;,&quot; expr)*</span></span><span class="token-line" style="color:#403f53"><span class="token plain">exception_case = qualid &quot;-&gt;&quot; formula</span></span><span class="token-line" style="color:#403f53"><span class="token plain">               | qualid pattern &quot;-&gt;&quot; formula</span></span><span class="token-line" style="color:#403f53"><span class="token plain">               | qualid</span></span><span class="token-line" style="color:#403f53"><span class="token plain">identifier_tuple = identifier (&quot;,&quot; identifier)*</span></span><span class="token-line" style="color:#403f53"><span class="token plain">parameter = &quot;()&quot; | identifier | &quot;~&quot; identifier | &quot;?&quot; identifier</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="default-behaviour"></a>Default behaviour<a class="hash-link" href="#default-behaviour" title="Direct link to heading">#</a></h2><p>To avoid boilerplate for usual properties, Gospel applies a default contract
whenever a function contains has a specification attached. Of course, any
explicitly declared clause overrides this implicit contract.</p><p>When a function has a contract attached, the default contract contains the
following properties:</p><ul><li>The function <strong>terminates</strong>.</li><li>The function <strong>does not raise any exception</strong> other than <code>Stack_overflow</code> or
<code>Out_of_memory</code>.</li><li>The function <strong>does not have any visible side-effect on the memory</strong>. In other
words, if it mutates some data, this has no observable influence on the values
in the rest of the program.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="pre-conditions"></a>Pre-conditions<a class="hash-link" href="#pre-conditions" title="Direct link to heading">#</a></h2><p>Pre-conditions are <strong>properties that hold at the function entry</strong>. You can use
them to describe requirements on the function&#x27;s inputs, but also possibly on a
global state that exists outside of the function arguments.</p><p>You can expressed them using the keyword <code>requires</code> or <code>checks</code>, followed by a
formula.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="requires"></a><code>requires</code><a class="hash-link" href="#requires" title="Direct link to heading">#</a></h3><p>A <code>requires</code> clause states under which conditions specified function has a
well-specified behaviour.</p><p>Whenever a <code>requires</code> pre-condition is violated, its behaviour becomes
unspecified, and the call should be considered faulty. Even if the function
execution terminates, any other information provided by the contract
(post-conditions, exceptions, effects, ...) cannot be assumed.</p><p>In our example, the function requires <code>y</code> to be positive to behave correctly.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">val</span><span class="token plain"> eucl_division</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> int </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> int </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> int </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> int</span></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ q, r = eucl_division x y</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    requires y &gt; 0</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    ensures  x = q * y + r</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    ensures  0 &lt;= r &lt; y *)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="checks"></a><code>checks</code><a class="hash-link" href="#checks" title="Direct link to heading">#</a></h3><p>Pre-conditions introduced with <code>checks</code> hold at function entry. However, unlike
<code>requires</code> clauses, the behaviour of the function is well specified in case the
pre-state does not meet such a pre-condition: the function fails by raising an
OCaml <code>Invalid_argument</code> exception, and does not modify any existing state. The
call is not faulty, but the caller is now in charge of handling the exception.</p><p>The same function contract, where <code>requires</code> is replaced with <code>checks</code>, states
that the function raises <code>Invalid_argument</code> whenever <code>y &lt;= 0</code>.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Combining multiple pre-conditions</h5></div><div class="admonition-content"><p>Whenever multiple pre-conditions of the same kind coexist, they hold as a
conjunction, which means</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ ...</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    requires P</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    requires Q *)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>is equivalent to:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ ...</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    requires P /\ Q *)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>When combining <code>checks</code> and <code>requires</code> pre-conditions, the declaration order
does not matter. The <code>requires</code> clauses take precedence and must always be
respected; otherwise the <code>checks</code> behaviour cannot be assumed. This means that
ultimately,</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ ...</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    requires P</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    checks Q *)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>is equivalent to:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ ...</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    requires P</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    checks P -&gt; Q *)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Specification formulas can often be written using few clauses, but splitting the
specification into several smaller clauses leads to better readability and
maintainability and is encouraged.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="post-conditions"></a>Post-conditions<a class="hash-link" href="#post-conditions" title="Direct link to heading">#</a></h2><p>Post-Conditions are <strong>properties that hold at the function exit</strong>. They are used
to specify how the function&#x27;s outputs relate to its inputs and how the call
mutated the memory.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>  <strong>When a function raises an exception, its post-conditions are not expected to
hold.</strong> You must use exceptional post-conditions instead.</p></div></div><p>Gospel introduces post-conditions using the keyword <code>ensures</code>, followed by a
formula.</p><p>As discussed in the previous section, the property expressed by the formula is
verified after the function call only if the pre-conditions were satisfied.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Combining multiple post-conditions</h5></div><div class="admonition-content"><p>The handling of multiple post-conditions is identical to pre-conditions of the
same kind: multiple post-conditions are merged as a conjunction:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ ...</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    ensures P</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    ensures Q *)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>is equivalent to:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ ...</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    ensures P /\ Q *)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="exceptional-post-conditions"></a>Exceptional post-conditions<a class="hash-link" href="#exceptional-post-conditions" title="Direct link to heading">#</a></h2><p>Exceptional post-conditions are used to specify the exceptions that can be
raised by the function, and what post-conditions hold in those cases.</p><p>By default, functions should not raise any exceptions, and doing so is a
violation of the specification. Whenever a function can raise an exception as
part of its expected behaviour, this exception must be listed, along with the
associated post-conditions.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Some exceptions are implicitly allowed and do not have to be listed, because
they could be unexpectedly triggered depending on the specifics of the machine
the code is executed on.</p><p><strong>The implicitly allowed exceptions are <code>Stack_overflow</code> and <code>Out_of_memory</code>.</strong></p><p>This is equivalent to adding a <code>raises Out_of_memory | Stack_overflow -&gt; true</code>
clause to every function contract. Of course, you can still override that
behaviour by stating a property whenever these exceptions are raised, like any
other exception:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ ...</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    raises Stack_overflow -&gt; false *)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div><p>Exceptional clauses are expressed using a <code>raises</code> keyword, followed by a list
of cases associating each exception with its formula, with a syntax similar to
pattern-matching.</p><p>Gospel expects each <code>raises</code> clause to perform an exhaustive pattern matching
for each exception constructor listed in this clause. Similarly to OCaml&#x27;s
pattern-matching, when an exception is raised, the post-condition that is
satisfied is the first match in the list of the cases.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ ...</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    raises Unix_error (ENAMETOOLONG, _, _) -&gt; P</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">         | Unix_error _                    -&gt; Q *)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In the previous contract (notice that it is an exhaustive pattern-matching on
the <code>Unix_error</code> exception) only states that <code>P</code> holds whenever <code>Unix_error</code> is
raised with argument <code>ENAMETOOLONG</code>, and that <code>Q</code> holds whenever the function
raises <code>Unix_error</code> with a different argument (<code>P</code> does not necessarily hold in
this case).</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Combining multiple exceptional post-conditions</h5></div><div class="admonition-content"><p>When multiple exceptional post-conditions exist, they are hold independently of
each other, meaning that the raised exception is matched against each <code>raises</code>&#x27;s
case list, and each matching post-condition must hold in conjunction. For
instance, the contract:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ ...</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    raises Error &quot;foo&quot; -&gt; P | Error _ -&gt; Q</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    raises Error x -&gt; R *)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>implies that</p><ul><li>when <code>Error &quot;foo&quot;</code> is raised, both <code>P</code> and <code>R</code> hold, but not necessarily <code>Q</code>;</li><li>when <code>Error</code> is raised with with an argument different from <code>&quot;foo&quot;</code>, both <code>Q</code>
and <code>R</code> hold, but not necessarily <code>P</code>.</li></ul></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="code-equivalence"></a>Code equivalence<a class="hash-link" href="#code-equivalence" title="Direct link to heading">#</a></h2><p>Complementary to other specification clauses, Gospel allows you to talk about
<em>code equivalence</em> in the function contract. It consists in a string containing
the OCaml code the function behaves like, preceded by the <code>equivalent</code> keyword.</p><p>This is useful when specifying functions which behaviour can hardly be expressed
in pure logic:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">val</span><span class="token plain"> iter </span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> unit</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> t </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> unit</span></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ iter f t</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    equivalent &quot;List.iter f (to_list t)&quot; *)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>With such a specification, no logical assertion is provided, but applying <code>iter</code>
to <code>f</code> and <code>t</code> is equivalent to applying <code>List.iter</code> to <code>f</code>, and the conversion
of <code>t</code> to a list. This does not leak implementation details, as <code>iter</code> might in
fact be implemented in a different, more efficient way. It does however make the
specification concise and elegant.</p><div class="admonition admonition-danger alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</h5></div><div class="admonition-content"><p>At the moment, the Gospel type-checker does <strong>not</strong> type-check the code provided
inside the <code>equivalent</code> clauses, and will take it as-is.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="non-termination"></a>Non termination<a class="hash-link" href="#non-termination" title="Direct link to heading">#</a></h2><p>By default, OCaml functions with attached contract implicitly terminate.</p><p>If a function is allowed to not terminate (e.g. a server main loop, a function
waiting for a signal or event, etc.), one can add this information to the
contract using the <code>diverges</code> keyword.</p><p>The following example states that the execution of the function <code>run</code> may not
terminate. It does not specify whether this function is always non-terminating
or not.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">val</span><span class="token plain"> run </span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> unit </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> unit</span></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ run ()</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    diverges *)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="data-mutability"></a>Data mutability<a class="hash-link" href="#data-mutability" title="Direct link to heading">#</a></h2><p>In the default specification, functions do not mutate any observable data. If
your function mutates an argument or some global state, you may specify it using
the keyword <code>modifies</code>, followed by an identifier. In the following, the
<code>contents</code> model of <code>a</code> can be modified by <code>inplace_map</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">val</span><span class="token plain"> inplace_map </span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> t </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> unit</span></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ inplace_map f a</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    modifies a.contents *)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If the function only modifies a few models of a value, these may be explicitly
added to the clause.</p><p>If a specific model is not mentioned, the whole data-structure and its mutable
models are potentially mutated.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">val</span><span class="token plain"> inplace_map </span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> t </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> unit</span></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ inplace_map f a</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    modifies a *)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In this example, all the mutable models of <code>a</code> can be mutated by <code>inplace_map</code>.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>When a <code>modifies</code> clause is present, it affects all the declared post-conditions
and exceptional post-conditions, meaning that the function may mutate data even
in the case of exceptional post-conditions.</p><p>If your data was not mutated in an exceptional post-state, for instance if the
function raised an exception <strong>instead</strong> of mutating the data, you have to
manually specify it:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">val</span><span class="token plain"> inplace_map </span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> t </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> unit</span></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ inplace_map f a</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    modifies a.contents</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    raises E -&gt; a.contents = old (a.contents) *)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="pure-functions"></a>Pure functions<a class="hash-link" href="#pure-functions" title="Direct link to heading">#</a></h2><p>An OCaml function can be declared as <code>pure</code>, which means</p><ul><li>it has no side effect;</li><li>it raises no exception;</li><li>it terminates.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">val</span><span class="token plain"> length </span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> t </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> int</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ pure *)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Pure functions can be used in further Gospel specifications.
On the contrary, OCaml functions not declared as <code>pure</code> cannot be used
in specifications.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="data-consumption"></a>Data consumption<a class="hash-link" href="#data-consumption" title="Direct link to heading">#</a></h2><p>Gospel provides a specific syntax to specify that some data has been consumed by
the function, and should be considered dirty â€” that is, not be used anymore â€” in
the rest of the program.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="ghost-parameters"></a>Ghost parameters<a class="hash-link" href="#ghost-parameters" title="Direct link to heading">#</a></h2><p>Functions can take or return ghost values to ease the writing of function
contracts. Such values appear within brackets in the contract header.</p><p>Let us consider the following <code>log2</code> function:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">val</span><span class="token plain"> log2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> int </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> int</span></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ r = log2 [i: integer] x</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    requires i &gt;= 0</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    requires x = pow 2 i</span></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    ensures r = i *)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In this contract, the ghost parameter <code>i</code> is used in both the pre- and
postcondition. By introducing it as a ghost value, we avoid using quantifiers to
state the existence of <code>i</code>.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Since the type of ghost parameters does not appear in the OCaml signature, it
must be given explicitly.</p></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/gospel/language/constants-specifications"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Constants specifications</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/gospel/language/logical"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Logical declarations<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#default-behaviour" class="table-of-contents__link">Default behaviour</a></li><li><a href="#pre-conditions" class="table-of-contents__link">Pre-conditions</a><ul><li><a href="#requires" class="table-of-contents__link"><code>requires</code></a></li><li><a href="#checks" class="table-of-contents__link"><code>checks</code></a></li></ul></li><li><a href="#post-conditions" class="table-of-contents__link">Post-conditions</a></li><li><a href="#exceptional-post-conditions" class="table-of-contents__link">Exceptional post-conditions</a></li><li><a href="#code-equivalence" class="table-of-contents__link">Code equivalence</a></li><li><a href="#non-termination" class="table-of-contents__link">Non termination</a></li><li><a href="#data-mutability" class="table-of-contents__link">Data mutability</a></li><li><a href="#pure-functions" class="table-of-contents__link">Pure functions</a></li><li><a href="#data-consumption" class="table-of-contents__link">Data consumption</a></li><li><a href="#ghost-parameters" class="table-of-contents__link">Ghost parameters</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2020â€”2021 Gospel maintainers.</div></div></div></footer></div>
<script src="/gospel/assets/js/runtime~main.289d4682.js"></script>
<script src="/gospel/assets/js/main.6b291231.js"></script>
</body>
</html>